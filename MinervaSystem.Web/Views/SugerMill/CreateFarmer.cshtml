@using MinervaSystem.Base.Models
@using MinervaSystem.Base.Models.ViewModels;
@model FarmerViewModel
@{
    ViewBag.Title = "Create a New Farmer";
    @Styles.Render("~/Content/kendo.office365")
    ViewBag.ReturnUrl = "/SugerMill";
    ViewBag.HeaderContent = ViewBag.HeaderContent ?? new HeaderContentModel("Update Your Profile", new BreadcrumbModel("Create Farmer"));
}

@Html.Partial("_HeaderContentPartial", (HeaderContentModel)ViewBag.HeaderContent)

<section class="content">
    <div class="row">
        <div class="col-xs-12">
            <div class="box">
                <div id="placeHolder-main" class="col-md-8">
                    @using (Html.BeginForm("CreateFarmer", "SugerMill", FormMethod.Post, new { @class = "form-horizontal", role = "form", enctype = "multipart/form-data" }))
                    {
                        @Html.AntiForgeryToken()
                        @Html.ValidationSummary("", new { @class = "text-danger" })
                        @Html.HiddenFor(m => m.Photo)

                        <div class="form-group">
                            @Html.LabelFor(m => m.Name, new { @class = "col-xs-3 col-form-label" })
                            <div class="col-md-9">
                                @Html.TextBoxFor(m => m.Name, new { @class = "form-control" })
                            </div>
                        </div>
                        <div class="form-group" style="margin-left: 0%;">
                            @Html.LabelFor(m => m.Photo, new { @class = "col-xs-3 col-form-label" })
                            <div class="col-md-9 row">
                                <img id="imgPhoto" src="" height="125" width="125" class="img-thumbnail" style="display:none" />
                                @Html.TextBoxFor(m => m.PhotoFile, new { @class = "form-control", type = "file", id = "txtPhoto" })
                            </div>
                        </div>
                        <div class="form-group">
                            @Html.LabelFor(m => m.BirthDate, new { @class = "col-xs-3 col-form-label" })
                            <div class="col-md-9">
                                @Html.TextBoxFor(m => m.BirthDate, "{0:dd/MM/yyyy}", new { @class = "form-control kendo-datepicker" })
                            </div>
                        </div>
                        <div class="form-group">
                            @Html.LabelFor(m => m.Email, new { @class = "col-xs-3 col-form-label" })
                            <div class="col-md-9">
                                @Html.TextBoxFor(m => m.Email, new { @class = "form-control" })
                            </div>
                        </div>
                        <div class="form-group">
                            @Html.LabelFor(m => m.CellPhone, new { @class = "col-xs-3 col-form-label" })
                            <div class="col-md-9">
                                @Html.TextBoxFor(m => m.CellPhone, new { @class = "form-control" })
                            </div>
                        </div>
                        <div class="form-group">
                            @Html.LabelFor(m => m.Phone, new { @class = "col-xs-3 col-form-label" })
                            <div class="col-md-9">
                                @Html.TextBoxFor(m => m.Phone, new { @class = "form-control" })
                            </div>
                        </div>
                        <div class="form-group">
                            @Html.LabelFor(m => m.NationalIdNo, new { @class = "col-xs-3 col-form-label" })
                            <div class="col-md-9">
                                @Html.TextBoxFor(m => m.NationalIdNo, new { @class = "form-control" })
                            </div>
                        </div>
                        <div class="form-group">
                            @Html.LabelFor(m => m.StateName, new { @class = "col-xs-3 col-form-label" })
                            <div class="col-md-9">
                                @*<select id="ddlState"></select>*@
                                @Html.DropDownListFor(m => m.StateId, new SelectList(Enumerable.Empty<SelectListItem>()), "Select", new { @class = "form-control" })
                            </div>
                        </div>
                        <div class="form-group">
                            @Html.LabelFor(m => m.DistrictName, new { @class = "col-xs-3 col-form-label" })
                            <div class="col-md-9">
                                @*<select id="ddlDistrict"></select>*@
                                @Html.DropDownListFor(m => m.DistrictId, new SelectList(Enumerable.Empty<SelectListItem>()), "Select", new { @class = "form-control" })
                            </div>
                        </div>
                        <div class="form-group">
                            @Html.LabelFor(m => m.UpazilaName, new { @class = "col-xs-3 col-form-label" })
                            <div class="col-md-9">
                                @*<select id="ddlUpazila"></select>*@
                                @Html.DropDownListFor(m => m.UpazilaId, new SelectList(Enumerable.Empty<SelectListItem>()), "Select", new { @class = "form-control" })
                            </div>
                        </div>
                        <div class="form-group">
                            @Html.LabelFor(m => m.PostalCode, new { @class = "col-xs-3 col-form-label" })
                            <div class="col-md-9">
                                @Html.TextBoxFor(m => m.PostalCode, new { @class = "form-control" })
                            </div>
                        </div>
                        <div class="form-group">
                            @Html.LabelFor(m => m.Village, new { @class = "col-xs-3 col-form-label" })
                            <div class="col-md-9">
                                @Html.TextBoxFor(m => m.Village, new { @class = "form-control" })
                            </div>
                        </div>
                        <div class="form-group">
                            @Html.LabelFor(m => m.ZoneId, new { @class = "col-xs-3 col-form-label" })
                            <div class="col-md-9">
                                @Html.EnumDropDownListFor(m => m.ZoneId, htmlAttributes: new { @class = "form-control" })
                            </div>
                        </div>
                        <div class="form-group">
                            @Html.LabelFor(m => m.EmergencyContact, new { @class = "col-xs-3 col-form-label" })
                            <div class="col-md-9">
                                @Html.TextBoxFor(m => m.EmergencyContact, new { @class = "form-control" })
                            </div>
                        </div>
                        <div class="form-group">
                            @Html.LabelFor(m => m.EmergencyContactPhone, new { @class = "col-xs-3 col-form-label" })
                            <div class="col-md-9">
                                @Html.TextBoxFor(m => m.EmergencyContactPhone, new { @class = "form-control" })
                            </div>
                        </div>
                        <div class="form-group">
                            @Html.LabelFor(m => m.Note, new { @class = "col-xs-3 col-form-label" })
                            <div class="col-md-9">
                                @Html.TextBoxFor(m => m.Note, new { @class = "form-control" })
                            </div>
                        </div>
                        <div class="btn-toolbar" style="float: right;">
                            <button type="submit" value="Submit" class="btn btn-default"><i class="fa fa-check-square-o btn-save"></i> Submit</button>
                            <a href="@ViewBag.ReturnUrl" class="btn btn-default "><i class="fa fa-ban btn-cancel"></i> Cancel</a>
                        </div>
                    }
                </div>
                <div style="clear:both;"></div>
            </div>
        </div>
    </div>
</section>
@section Scripts {
    @Scripts.Render("~/bundles/cldr")
    @Scripts.Render("~/bundles/globalize")
    @Scripts.Render("~/bundles/jqueryval")
    @Scripts.Render("~/bundles/kendo")
    <script type="text/javascript">
        $(document).ready(function () {
            farmer.init();
        });
        var farmer = {
            init: function () {
                $.validator.addMethod(
                     "date",
                     function (value, element) {
                         var bits = value.match(/([0-9]+)/gi), str;
                         if (!bits)
                             return this.optional(element) || false;
                         str = bits[1] + '/' + bits[0] + '/' + bits[2];
                         return this.optional(element) || !/Invalid|NaN/.test(new Date(str));
                     },
                     "Please enter a date in the format dd/mm/yyyy"
                 );
                $('#StateId').off('change').change(function () {
                    utility.RemoveAllOptions('#DistrictId', "Select");
                    utility.RemoveAllOptions('#UpazilaId', "Select");
                    var cityUrl = '@Url.Action("GetAllCity", "SugerMill")';
                    var cityResponse = utility.getCity($('#StateId').val(), cityUrl, function (response) {
                        utility.populateCountryCityUpazillaDropDown('#DistrictId', response.aaData);
                    });
                });
                $('#DistrictId').off('change').change(function () {
                    utility.RemoveAllOptions('#UpazilaId', "Select");
                    var upazilaUrl = '@Url.Action("GetAllUpazilla", "SugerMill")';
                    var stateResponse = utility.getUpazilla($('#DistrictId').val(),upazilaUrl, function (response) {
                        utility.populateCountryCityUpazillaDropDown('#UpazilaId', response.aaData);
                    });
                });
                farmer.loadDropDown();
                farmer.uploadPhoto();
            },
            loadDropDown: function () {
                var stateUrl = '@Url.Action("GetAllState", "SugerMill")';
                var stateResponse = utility.getState(1, stateUrl, function (response) {
                    utility.populateCountryCityUpazillaDropDown('#StateId', response.aaData);
                });
            },
            uploadPhoto: function () {
                $("#txtPhoto").kendoUpload({
                    multiple: false,
                    select: function (e) {
                        if (e.files && $.inArray(e.files[0].extension.toLowerCase(), G_oImageFileExtensions) > -1) {
                            var reader = new FileReader();
                            reader.onload = function (event) { $("#imgPhoto").attr("src", event.target.result) };
                            reader.readAsDataURL(e.files[0].rawFile);
                            $("#imgPhoto").show();
                        } else {    //clear the preview and model data
                            $("#imgPhoto").attr("src", "");
                            $("#imgPhoto").hide();
                            e.preventDefault();
                            $("ul.k-upload-files").remove();
                            KendoAlert("Selected file is not an image file. Please select an image file.");
                            $("#txtPhoto").val("");
                        }
                    }
                });
            }
        }
    </script>
}
